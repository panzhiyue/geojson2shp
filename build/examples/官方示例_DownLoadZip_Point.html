<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <link rel="stylesheet" href="./resources/prism/prism.css" type="text/css">
    <link rel="stylesheet" href="./resources/layout.css" type="text/css">
    <script src="js/GeoJson2Shp.js"></script>
    <script src="js/extend/jquery.js"></script>
    <script src="js/extend/jszip/jszip.js"></script>
    <script src="js/extend/FileSaver.js"></script>
    
    


    <title>点下载为Zip</title>
</head>
<body style="height:100%;overflow:hidden;background-color:#fff;">

    <h4 id="title">点下载为Zip</h4>
    <div id="docs"><p>这个示例展示了如何把矢量点geojson导出为shp并压缩为zip</p>
</div>

    <div id="main" style="width:100%;height:100%;">
    <input type="button" id="btnDownLoad" value="下载" />
</div>

    <script>
        ﻿
var gj = '{"type":"FeatureCollection", "features": [{ "type": "Feature", "geometry": { "type": "Point", "coordinates": [120, 28] }, "properties": { "NAME": "测试点" } },{ "type": "Feature", "geometry": { "type": "Point", "coordinates": [121, 28] }, "properties": { "NAME": "测试点2" } },{ "type": "Feature", "geometry": { "type": "Point", "coordinates": [122, 28] }, "properties": { "NAME": "测试点3" } }]}';

var cpg = 'UTF-8';
var projection = 'GEOGCS[\"GCS_China_Geodetic_Coordinate_System_2000\",DATUM[\"D_China_2000\",SPHEROID[\"CGCS2000\",6378137.0,298.257222101]],PRIMEM[\"Greenwich\",0.0],UNIT[\"Degree\",0.0174532925199433]]';

$("#btnDownLoad").bind("click", function () {
    var zip = new JSZip(),
        layers = zip.folder('layers');
    console.log(GeoJson2Shp);
    var g2s = new GeoJson2Shp.GeoJson2Shp(gj);
    g2s.writePoint(function (err, files) {
        var fileName = "point";
        layers.file(fileName + '.shp', files.shp.buffer, { binary: true });
        layers.file(fileName + '.shx', files.shx.buffer, { binary: true });
        layers.file(fileName + '.dbf', files.dbf.buffer, { binary: true });
        layers.file(fileName + '.prj', projection);
        layers.file(fileName + '.cpg', cpg);

    }.bind(this));

    g2s.writeMultiPoint(function (err, files) {
        var fileName = "multipoint";
        layers.file(fileName + '.shp', files.shp.buffer, { binary: true });
        layers.file(fileName + '.shx', files.shx.buffer, { binary: true });
        layers.file(fileName + '.dbf', files.dbf.buffer, { binary: true });
        layers.file(fileName + '.prj', projection);
        layers.file(fileName + '.cpg', cpg);

    }.bind(this));

    g2s.writePolyline(function (err, files) {
        var fileName = "polyline";
        layers.file(fileName + '.shp', files.shp.buffer, { binary: true });
        layers.file(fileName + '.shx', files.shx.buffer, { binary: true });
        layers.file(fileName + '.dbf', files.dbf.buffer, { binary: true });
        layers.file(fileName + '.prj', projection);
        layers.file(fileName + '.cpg', cpg);
    }.bind(this));

    g2s.writePolygon(function (err, files) {
        var fileName = "polygon";
        layers.file(fileName + '.shp', files.shp.buffer, { binary: true });
        layers.file(fileName + '.shx', files.shx.buffer, { binary: true });
        layers.file(fileName + '.dbf', files.dbf.buffer, { binary: true });
        layers.file(fileName + '.prj', projection);
        layers.file(fileName + '.cpg', cpg);
    }.bind(this));

    var zipName = "example";
    zip.generateAsync({ type: "blob" })
        .then(function (content) {
            // see FileSaver.js
            saveAs(content, zipName + ".zip");
        });
});
</script>
</body>
</html>
