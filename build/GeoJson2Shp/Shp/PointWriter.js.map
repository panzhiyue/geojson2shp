{"version":3,"file":"PointWriter.js","sources":["../../../src/GeoJson2Shp/Shp/PointWriter.js"],"sourcesContent":["﻿/**\r\n * @module GeoJson2Shp/Shp/PointsWriter\r\n */\r\n\r\nimport * as ext from './Extent.js'\r\nimport Writer from './Writer.js'\r\n\r\n/**\r\n * 点写入器 \r\n * shp文件点内容\r\n * -------------------------------------\r\n *          |=======================|  ^\r\n * 00h /   0| 记录号(表示第几个图斑)|  |\r\n *          | 从1开始               |  |                  \r\n *          |-----------------------|头信息\r\n * 01h /   4| 内容所占长度          |  |\r\n *          |=======================|--v\r\n * 02h /  8 | 几何图形类型          |  ^\r\n *          |-----------------------|  |\r\n * 03h /  12| x坐标                 |  内容\r\n *          |-----------------------|  |\r\n * 04h /  20| y坐标                 |  |\r\n *          |-----------------------|  v\r\n * -------------------------------------\r\n */\r\nclass PointWriter extends Writer {\r\n\r\n    /**\r\n     * @inheritdoc\r\n     */\r\n    constructor(geometries, type) {\r\n        super(geometries, type);\r\n    }\r\n\r\n    /**\r\n     * @inheritdoc\r\n     */\r\n    writeGeometry(shpView, shxView) {\r\n\r\n        /**\r\n         * 1个图形内容所占长度\r\n         * (1)几何类型(4)\r\n         * (2)x坐标(8)\r\n         * (3)y坐标(8)\r\n         * @type {number}\r\n         */\r\n        var contentLength = 20;\r\n\r\n        /**\r\n         * 1个图形头信息所占长度\r\n         * (1)记录号(4)\r\n         * (2)内容所占长度(4)\r\n         * @type {number}\r\n         */\r\n        var headerLength = 8;\r\n\r\n        /**\r\n         * 几何图形信息在shp文件流中起始位置 \r\n         * @type {number}\r\n         */\r\n        var shpI = 100;\r\n\r\n        /**\r\n         * 几何图形信息在shx文件流中起始位置\r\n         * @type {number}\r\n         */\r\n        var shxI = 100;\r\n\r\n        //循环写入几何图形\r\n        this.geometries_.forEach(function writePoint(coords, i) {\r\n            //#region shx文件\r\n            //shx写入几何图形在shp文件起始位值(4)\r\n            shxView.setInt32(shxI, shpI / 2);\r\n            //shx写入记录内容长度(4)   (图形类型+x坐标+y坐标)/2=(4+8+8)/2 =20\r\n            shxView.setInt32(shxI + 4, contentLength / 2);\r\n            //shx文件下一个图形写入位置:记录位移量(4)+记录长度(4)=8\r\n            shxI += 8;\r\n            //#endregion shx文件\r\n\r\n            //#region shp文件\r\n            //shp写入记录号,从1开始(4)\r\n            shpView.setInt32(shpI, i + 1);\r\n            //shp写入内容长度(4)\r\n            shpView.setInt32(shpI + 4, contentLength / 2);\r\n            //shp写入几何图形类型(4)\r\n            shpView.setInt32(shpI + 8, this.type_, true);\r\n            //shp写入x坐标(8)\r\n            shpView.setFloat64(shpI + 12, coords[0], true);\r\n            //shp写入y坐标(8)\r\n            shpView.setFloat64(shpI + 20, coords[1], true);\r\n\r\n            //shp文件下一个图形写入起始位置\r\n            shpI += contentLength + headerLength;\r\n            //#endregion shp文件\r\n\r\n        }.bind(this));\r\n    }\r\n\r\n    /**\r\n     * @inheritdoc \r\n     */\r\n    getPartCount(geometries) {\r\n        return geometries.length;\r\n    }\r\n\r\n    /**\r\n     * @inheritdoc\r\n     */\r\n    getExtent() {\r\n        return this.geometries_.reduce(function (extent, coords) {\r\n            return ext.extendCoordinate(extent, coords);\r\n        }, ext.createEmpty());\r\n    }\r\n\r\n    /**\r\n     * @inheritdoc\r\n     */\r\n    getShpLength() {\r\n        return this.geometries_.length * 28;\r\n    }\r\n\r\n    /**\r\n     * @inheritdoc\r\n     */\r\n    getShxLength() {\r\n        return this.geometries_.length * 8;\r\n    }\r\n}\r\n\r\nexport default PointWriter;\r\n"],"names":["super"],"mappings":"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"}