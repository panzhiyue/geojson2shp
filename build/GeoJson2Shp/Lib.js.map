{"version":3,"file":"Lib.js","sources":["../../src/GeoJson2Shp/Lib.js"],"sourcesContent":["﻿/**\r\n * @module GeoJson2Shp/Dbf/Lib\r\n */\r\n\r\n/**\r\n * 左补位\r\n * @param {string} str 原字符串\r\n * @param {number} len 目标字符串长度\r\n * @param {string} char 补位字符\r\n * @returns {string} 补位后的字符串\r\n */\r\nexport function lpad(str, len, char) {\r\n    while (str.length < len) { str = char + str; } return str;\r\n};\r\n\r\n/**\r\n * 右补位\r\n * @param {string} str 原字符串\r\n * @param {number} len 目标字符串长度\r\n * @param {string} char 补位字符\r\n * @returns {string} 补位后的字符串\r\n */\r\nexport function rpad(str, len, char) {\r\n    while (str.length < len) { str = str + char; } return str;\r\n};\r\n\r\n/**\r\n * 修改\r\n * 作者:潘知悦\r\n * 描述:中文乱码问题\r\n * @param {object} view\r\n * @param {number} fieldLength\r\n * @param {string} str\r\n * @param {number} offset\r\n * @returns {number}\r\n */\r\nexport function writeField(view, fieldLength, str, offset) {\r\n    let uint8Array = stringToUint8Array(str);\r\n    for (var i = 0; i < fieldLength; i++) {\r\n        view.setUint8(offset, uint8Array[i]);\r\n        offset++;\r\n    }\r\n    return offset;\r\n};\r\n/**\r\n * 字符串转Uint8Array\r\n * @param {string} string\r\n * @param {Object} options \r\n * @param {boolean} [options.stream] 是否为流\r\n */\r\nexport function stringToUint8Array(string, options = { stream: false }) {\r\n    if (options.stream) {\r\n        throw new Error(`Failed to encode: the 'stream' option is unsupported.`);\r\n    }\r\n\r\n    let pos = 0;\r\n    const len = string.length;\r\n    const out = [];\r\n\r\n    let at = 0;  // output position\r\n    let tlen = Math.max(32, len + (len >> 1) + 7);  // 1.5x size\r\n    let target = new Uint8Array((tlen >> 3) << 3);  // ... but at 8 byte offset\r\n\r\n    while (pos < len) {\r\n        let value = string.charCodeAt(pos++);\r\n        if (value >= 0xd800 && value <= 0xdbff) {\r\n            // high surrogate\r\n            if (pos < len) {\r\n                const extra = string.charCodeAt(pos);\r\n                if ((extra & 0xfc00) === 0xdc00) {\r\n                    ++pos;\r\n                    value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\r\n                }\r\n            }\r\n            if (value >= 0xd800 && value <= 0xdbff) {\r\n                continue;  // drop lone surrogate\r\n            }\r\n        }\r\n\r\n        // expand the buffer if we couldn't write 4 bytes\r\n        if (at + 4 > target.length) {\r\n            tlen += 8;  // minimum extra\r\n            tlen *= (1.0 + (pos / string.length) * 2);  // take 2x the remaining\r\n            tlen = (tlen >> 3) << 3;  // 8 byte offset\r\n\r\n            const update = new Uint8Array(tlen);\r\n            update.set(target);\r\n            target = update;\r\n        }\r\n\r\n        if ((value & 0xffffff80) === 0) {  // 1-byte\r\n            target[at++] = value;  // ASCII\r\n            continue;\r\n        } else if ((value & 0xfffff800) === 0) {  // 2-byte\r\n            target[at++] = ((value >> 6) & 0x1f) | 0xc0;\r\n        } else if ((value & 0xffff0000) === 0) {  // 3-byte\r\n            target[at++] = ((value >> 12) & 0x0f) | 0xe0;\r\n            target[at++] = ((value >> 6) & 0x3f) | 0x80;\r\n        } else if ((value & 0xffe00000) === 0) {  // 4-byte\r\n            target[at++] = ((value >> 18) & 0x07) | 0xf0;\r\n            target[at++] = ((value >> 12) & 0x3f) | 0x80;\r\n            target[at++] = ((value >> 6) & 0x3f) | 0x80;\r\n        } else {\r\n            // FIXME: do we care\r\n            continue;\r\n        }\r\n\r\n        target[at++] = (value & 0x3f) | 0x80;\r\n    }\r\n\r\n    return target.slice(0, at);\r\n}\r\n"],"names":["let","const"],"mappings":"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"}