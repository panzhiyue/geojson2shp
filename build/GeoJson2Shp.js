!function(){"use strict";function extendCoordinate(t,e){return e[0]<t.xmin&&(t.xmin=e[0]),e[0]>t.xmax&&(t.xmax=e[0]),e[1]<t.ymin&&(t.ymin=e[1]),e[1]>t.ymax&&(t.ymax=e[1]),t}function createEmpty(){return{xmin:Number.MAX_VALUE,ymin:Number.MAX_VALUE,xmax:-Number.MAX_VALUE,ymax:-Number.MAX_VALUE}}var Writer=function(t,e){this.geometries_=t,this.type_=e};Writer.prototype.write=function(t){var e=100+this.getShpLength(),n=100+this.getShxLength(),r=new ArrayBuffer(e),o=new DataView(r),i=new ArrayBuffer(n),s=new DataView(i),p=this.getExtent();this.writeHeader(o,this.type_),this.writeHeader(s,this.type_),this.writeExtent(p,o),this.writeExtent(p,s),this.writeGeometry(new DataView(r),new DataView(i)),o.setInt32(24,e/2),s.setInt32(24,n/2),t(null,{shp:o,shx:s})},Writer.prototype.writeHeader=function(t){t.setInt32(0,9994),t.setInt32(28,1e3,!0),t.setInt32(32,this.type_,!0)},Writer.prototype.writeExtent=function(t,e){e.setFloat64(36,t.xmin,!0),e.setFloat64(44,t.ymin,!0),e.setFloat64(52,t.xmax,!0),e.setFloat64(60,t.ymax,!0)},Writer.prototype.writeGeometry=function(t,e){},Writer.prototype.getShpLength=function(){},Writer.prototype.getShxLength=function(){},Writer.prototype.getExtent=function(){},Writer.prototype.getPartCount=function(t){},Writer.prototype.getFlattened=function(t,e){return void 0===e&&(e=[]),"object"==typeof t[0][0]?t.reduce(function(t,e){return t.concat(this.getFlattened(e))}.bind(this),e):t};var MultiPointWriter=function(n){function t(t,e){n.call(this,t,e)}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.writeGeometry=function(r,o){var i,s=100,p=100;this.geometries_.forEach(function(t,e){var n=this.getFlattened(t);i=40+16*n.length;t=n.reduce(function(t,e){return extendCoordinate(t,e)},createEmpty());o.setInt32(p,s/2),o.setInt32(p+4,i/2),p+=8,r.setInt32(s,e+1),r.setInt32(s+4,i/2),r.setInt32(s+8,this.type_,!0),r.setFloat64(s+12,t.xmin,!0),r.setFloat64(s+20,t.ymin,!0),r.setFloat64(s+28,t.xmax,!0),r.setFloat64(s+36,t.ymax,!0),r.setInt32(s+44,n.length,!0),n.forEach(function(t,e){r.setFloat64(s+48+16*e,t[0],!0),r.setFloat64(s+48+16*e+8,t[1],!0)}),s+=8+i}.bind(this))},t.prototype.getPartCount=function(t){return t.length},t.prototype.getExtent=function(){return this.getFlattened(this.geometries_).reduce(function(t,e){return extendCoordinate(t,e)},createEmpty())},t.prototype.getShxLength=function(){return 8*this.geometries_.length},t.prototype.getShpLength=function(){return 48*this.geometries_.length+16*this.getFlattened(this.geometries_).length},t}(Writer),PointWriter=function(n){function t(t,e){n.call(this,t,e)}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.writeGeometry=function(n,r){var o=100,i=100;this.geometries_.forEach(function(t,e){r.setInt32(i,o/2),r.setInt32(i+4,10),i+=8,n.setInt32(o,e+1),n.setInt32(o+4,10),n.setInt32(o+8,this.type_,!0),n.setFloat64(o+12,t[0],!0),n.setFloat64(o+20,t[1],!0),o+=28}.bind(this))},t.prototype.getPartCount=function(t){return t.length},t.prototype.getExtent=function(){return this.geometries_.reduce(function(t,e){return extendCoordinate(t,e)},createEmpty())},t.prototype.getShpLength=function(){return 28*this.geometries_.length},t.prototype.getShxLength=function(){return 8*this.geometries_.length},t}(Writer),PolyWriter=function(n){function t(t,e){n.call(this,t,e)}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.writeGeometry=function(p,u){var a,h=100,y=100;this.geometries_.forEach(function(t,e){var n=this.getFlattened(t),r=this.getPartCount([t],this.type_);a=44+4*r+16*n.length;var o=n.reduce(function(t,e){return extendCoordinate(t,e)},createEmpty());u.setInt32(y,h/2),u.setInt32(y+4,a/2),y+=8,p.setInt32(h,e+1),p.setInt32(h+4,a/2),p.setInt32(h+8,this.type_,!0),p.setFloat64(h+12,o.xmin,!0),p.setFloat64(h+20,o.ymin,!0),p.setFloat64(h+28,o.xmax,!0),p.setFloat64(h+36,o.ymax,!0),p.setInt32(h+44,r,!0),p.setInt32(h+48,n.length,!0),p.setInt32(h+52,0,!0);for(var i=t.reduce(function(t,e){return Array.isArray(e[0][0])?t=t.concat(e):t.push(e),t},[]),s=1;s<r;s++)p.setInt32(h+52+4*s,i.reduce(function(t,e,n){return n<s?t+e.length:t},0),!0);n.forEach(function(t,e){p.setFloat64(h+56+16*e+4*(r-1),t[0],!0),p.setFloat64(h+56+16*e+4*(r-1)+8,t[1],!0)}),h+=8+a}.bind(this))},t.prototype.getPartCount=function(t){return t.reduce(function(t,e){return t+=e.length,Array.isArray(e[0][0][0])&&(t+=e.reduce(function(t,e){return t+e.length-1},0)),t},0)},t.prototype.getExtent=function(){return this.getFlattened(this.geometries_).reduce(function(t,e){return extendCoordinate(t,e)},createEmpty())},t.prototype.getShpLength=function(){return 52*this.geometries_.length+4*this.getPartCount(this.geometries_)+16*this.getFlattened(this.geometries_).length},t.prototype.getShxLength=function(){return 8*this.geometries_.length},t}(Writer);function lpad(t,e,n){for(;t.length<e;)t=n+t;return t}function rpad(t,e,n){for(;t.length<e;)t+=n;return t}function stringToUint8Array(t,e){if((e=void 0===e?{stream:!1}:e).stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");for(var n=0,r=t.length,o=0,i=Math.max(32,r+(r>>1)+7),s=new Uint8Array(i>>3<<3);n<r;){var p,u=t.charCodeAt(n++);if(55296<=u&&u<=56319)if(n<r&&(56320==(64512&(p=t.charCodeAt(n)))&&(++n,u=((1023&u)<<10)+(1023&p)+65536)),55296<=u&&u<=56319)continue;if(o+4>s.length&&(i+=8,i=(i*=1+n/t.length*2)>>3<<3,(p=new Uint8Array(i)).set(s),s=p),0!=(4294967168&u)){if(0==(4294965248&u))s[o++]=u>>6&31|192;else if(0==(4294901760&u))s[o++]=u>>12&15|224,s[o++]=u>>6&63|128;else{if(0!=(4292870144&u))continue;s[o++]=u>>18&7|240,s[o++]=u>>12&63|128,s[o++]=u>>6&63|128}s[o++]=63&u|128}else s[o++]=u}return s.slice(0,o)}var FieldSize={C:254,L:1,D:8,N:18,M:18,F:18,B:8},FieldType={string:"C",number:"N",boolean:"L",null:"C"};function multi(t){var e={};return t.forEach(function(t){inherit(e,t)}),obj(e)}function inherit(t,e){for(var n in e){var r=void 0!==e[n]&&null!==e[n];void 0!==t[n]&&!r||(t[n]=e[n])}return t}function obj(t){var e,n,r={},o=[];for(e in t)r[e]=null===t[e]?"null":typeof t[e];for(n in r){var i=FieldType[r[n]];i&&o.push({name:n,type:i,size:FieldSize[i]})}return o}var Writer$1=function(t,e){this.field_meta_=e||multi(t),this.data_=t};Writer$1.prototype.write=function(t){var e=32*this.field_meta_.length,n=this.getBytesPerRecord(this.field_meta_),r=new ArrayBuffer(32+e+1+n*this.data_.length+1),o=new Date,i=new DataView(r);i.setUint8(0,3),i.setUint8(1,o.getFullYear()-1900),i.setUint8(2,o.getMonth()),i.setUint8(3,o.getDate()),i.setUint32(4,this.data_.length,!0);o=32+e+1;i.setUint16(8,o,!0),i.setUint16(10,n,!0),i.setInt8(32+e,13),this.field_meta_.forEach(function(t,e){for(var n=stringToUint8Array(rpad(t.name.slice(0,10),10," ")),r=0;r<10;r++)i.setInt8(32+32*e+r,n[r]);i.setInt8(32+32*e+11,t.type.charCodeAt(0)),i.setInt8(32+32*e+16,t.size),"N"==t.type&&i.setInt8(32+32*e+17,3)});var s=32+e+1;this.data_.forEach(function(n,t){i.setUint8(s,32),s++,this.field_meta_.forEach(function(t){var e=n[t.name];switch(null==e&&(e=""),t.type){case"L":i.setUint8(s,e?84:70),s++;break;case"D":s=this.writeField_(i,8,lpad(e.toString(),8," "),s);break;case"N":s=this.writeField_(i,t.size,lpad(e.toString(),t.size," ").substr(0,18),s);break;case"C":s=this.writeField_(i,t.size,rpad(e.toString(),t.size," "),s);break;default:throw new Error("Unknown field type")}}.bind(this))}.bind(this)),i.setUint8(s,26),t(null,{dbf:i})},Writer$1.prototype.writeField_=function(t,e,n,r){for(var o=stringToUint8Array(n),i=0;i<e;i++)t.setUint8(r,o[i]),r++;return r},Writer$1.prototype.getBytesPerRecord=function(t){return t.reduce(function(t,e){return t+e.size},1)};var geometryType={NULL:0,POINT:1,POLYLINE:3,POLYGON:5,MULTIPOINT:8,POINTZ:11,POLYLINEZ:13,POLYGONZ:15,MULTIPOINTZ:18,POINTM:21,POLYLINEM:23,POLYGONM:25,MULTIPOINTM:28,MULTIPATCH:31},GeoJson2Shp=function GeoJson2Shp(geojson){"string"==typeof geojson&&(geojson=eval("("+geojson+")")),this.geojson_=geojson};GeoJson2Shp.prototype.writePoint=function(t){this.write_(geometryType.POINT,t)},GeoJson2Shp.prototype.writeMultiPoint=function(t){this.write_(geometryType.MULTIPOINT,t)},GeoJson2Shp.prototype.writePolyline=function(t){this.write_(geometryType.POLYLINE,t)},GeoJson2Shp.prototype.writePolygon=function(t){this.write_(geometryType.POLYGON,t)},GeoJson2Shp.prototype.write_=function(t,r){var e=this.getWriteOptions_(t),t=this.getShpWriter_(t);e&&new t(e.geometries,e.type).write(function(t,n){new Writer$1(e.properties).write(function(t,e){n.dbf=e.dbf,r(t,n)})})},GeoJson2Shp.prototype.getShpWriter_=function(t){var e;return t==geometryType.POINT?e=PointWriter:t==geometryType.MULTIPOINT?e=MultiPointWriter:t!=geometryType.POLYLINE&&t!=geometryType.POLYGON||(e=PolyWriter),e},GeoJson2Shp.prototype.getPointOptions_=function(){var t=this.geojson_.features.filter(function(t){return"Point"===t.geometry.type});return t&&0!=t.length?{geometries:t.map(this.justCoords_),properties:t.map(this.justProps_),type:geometryType.POINT}:null},GeoJson2Shp.prototype.getMultiPointOptions_=function(){var t=this.geojson_.features.filter(function(t){return"MultiPoint"===t.geometry.type});return t&&0!=t.length?{geometries:t.map(this.justCoords_),properties:t.map(this.justProps_),type:geometryType.MULTIPOINT}:null},GeoJson2Shp.prototype.getPolylineOptions_=function(){var t=this.geojson_.features.filter(function(t){return"LineString"===t.geometry.type||"MultiLineString"===t.geometry.type});return t&&0!=t.length?{geometries:t.map(this.justCoords_),properties:t.map(this.justProps_),type:geometryType.POLYLINE}:null},GeoJson2Shp.prototype.getPolygonOptions_=function(){var t=this.geojson_.features.filter(function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type});return t&&0!=t.length?{geometries:t.map(this.justCoords_),properties:t.map(this.justProps_),type:geometryType.POLYGON}:null},GeoJson2Shp.prototype.getWriteOptions_=function(t){var e;return t==geometryType.POINT?e=this.getPointOptions_():t==geometryType.MULTIPOINT?e=this.getMultiPointOptions_():t==geometryType.POLYLINE?e=this.getPolylineOptions_():t==geometryType.POLYGON&&(e=this.getPolygonOptions_()),e},GeoJson2Shp.prototype.justCoords_=function(t){return"LineString"==t.geometry.type||"MultiLineString"==t.geometry.type?[t.geometry.coordinates]:t.geometry.coordinates},GeoJson2Shp.prototype.justProps_=function(t){return t.properties};var GeoJson2Shp$1=window.GeoJson2Shp={};GeoJson2Shp$1.GeoJson2Shp=GeoJson2Shp}();
//# sourceMappingURL=GeoJson2Shp.js.map
