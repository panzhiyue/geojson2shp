!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=8)}([function(t,e,r){"use strict";e.a={NULL:0,POINT:1,POLYLINE:3,POLYGON:5,MULTIPOINT:8,POINTZ:11,POLYLINEZ:13,POLYGONZ:15,MULTIPOINTZ:18,POINTM:21,POLYLINEM:23,POLYGONM:25,MULTIPOINTM:28,MULTIPATCH:31}},function(t,e,r){"use strict";function n(t,e){return e[0]<t.xmin&&(t.xmin=e[0]),e[0]>t.xmax&&(t.xmax=e[0]),e[1]<t.ymin&&(t.ymin=e[1]),e[1]>t.ymax&&(t.ymax=e[1]),t}function i(){return{xmin:Number.MAX_VALUE,ymin:Number.MAX_VALUE,xmax:-Number.MAX_VALUE,ymax:-Number.MAX_VALUE}}r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";e.a=class{constructor(t,e){this.geometries_=t,this.type_=e}write(t){var e=100+this.getShpLength(),r=100+this.getShxLength(),n=new ArrayBuffer(e),i=new DataView(n),_=new ArrayBuffer(r),o=new DataView(_),s=this.getExtent();this.writeHeader(i,this.type_),this.writeHeader(o,this.type_),this.writeExtent(s,i),this.writeExtent(s,o),this.writeGeometry(new DataView(n),new DataView(_)),i.setInt32(24,e/2),o.setInt32(24,r/2),t(null,{shp:i,shx:o})}writeHeader(t){t.setInt32(0,9994),t.setInt32(28,1e3,!0),t.setInt32(32,this.type_,!0)}writeExtent(t,e){e.setFloat64(36,t.xmin,!0),e.setFloat64(44,t.ymin,!0),e.setFloat64(52,t.xmax,!0),e.setFloat64(60,t.ymax,!0)}writeGeometry(t,e){}getShpLength(){}getShxLength(){}getExtent(){}getPartCount(t){}getFlattened(t,e){return void 0===e&&(e=[]),"object"==typeof t[0][0]?t.reduce(function(t,e){return t.concat(this.getFlattened(e))}.bind(this),e):t}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var _Shp_MultiPointWriter_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_Shp_PointWriter_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6),_Shp_PolyWriter_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_Dbf_Writer_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(7),_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(0);class GeoJson2Shp{constructor(geojson){"string"==typeof geojson&&(geojson=eval("("+geojson+")")),this.geojson_=geojson}writePoint(t){this.write_(_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POINT,t)}writeMultiPoint(t){this.write_(_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.MULTIPOINT,t)}writePolyline(t){this.write_(_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POLYLINE,t)}writePolygon(t){this.write_(_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POLYGON,t)}write_(t,e){var r=this.getWriteOptions_(t),n=this.getShpWriter_(t);r&&new n(r.geometries,r.type).write((function(t,n){new _Dbf_Writer_js__WEBPACK_IMPORTED_MODULE_3__.a(r.properties).write((function(t,r){n.dbf=r.dbf,e(t,n)}))}))}getShpWriter_(t){var e;return t==_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POINT?e=_Shp_PointWriter_js__WEBPACK_IMPORTED_MODULE_1__.a:t==_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.MULTIPOINT?e=_Shp_MultiPointWriter_js__WEBPACK_IMPORTED_MODULE_0__.a:(t==_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POLYLINE||t==_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POLYGON)&&(e=_Shp_PolyWriter_js__WEBPACK_IMPORTED_MODULE_2__.a),e}getPointOptions_(){var t=this.geojson_.features.filter((function(t){return"Point"===t.geometry.type}));return t&&0!=t.length?{geometries:t.map(this.justCoords_),properties:t.map(this.justProps_),type:_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POINT}:null}getMultiPointOptions_(){var t=this.geojson_.features.filter((function(t){return"MultiPoint"===t.geometry.type}));return t&&0!=t.length?{geometries:t.map(this.justCoords_),properties:t.map(this.justProps_),type:_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.MULTIPOINT}:null}getPolylineOptions_(){var t=this.geojson_.features.filter((function(t){return"LineString"===t.geometry.type||"MultiLineString"===t.geometry.type}));return t&&0!=t.length?{geometries:t.map(this.justCoords_),properties:t.map(this.justProps_),type:_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POLYLINE}:null}getPolygonOptions_(){var t=this.geojson_.features.filter((function(t){return"Polygon"===t.geometry.type||"MultiPolygon"===t.geometry.type}));return t&&0!=t.length?{geometries:t.map(this.justCoords_),properties:t.map(this.justProps_),type:_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POLYGON}:null}getWriteOptions_(t){var e;return t==_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POINT?e=this.getPointOptions_():t==_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.MULTIPOINT?e=this.getMultiPointOptions_():t==_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POLYLINE?e=this.getPolylineOptions_():t==_Shp_GeometryType_js__WEBPACK_IMPORTED_MODULE_4__.a.POLYGON&&(e=this.getPolygonOptions_()),e}justCoords_(t){return"LineString"==t.geometry.type||"MultiLineString"==t.geometry.type?[t.geometry.coordinates]:t.geometry.coordinates}justProps_(t){return t.properties}}__webpack_exports__.a=GeoJson2Shp},function(t,e,r){"use strict";var n=r(1),i=r(2);class _ extends i.a{constructor(t,e){super(t,e)}writeGeometry(t,e){var r,i=100,_=100;this.geometries_.forEach(function(o,s){var a=this.getFlattened(o),u=this.getPartCount([o],this.type_);r=44+4*u+16*a.length;var l=a.reduce((function(t,e){return n.b(t,e)}),n.a());e.setInt32(_,i/2),e.setInt32(_+4,r/2),_+=8,t.setInt32(i,s+1),t.setInt32(i+4,r/2),t.setInt32(i+8,this.type_,!0),t.setFloat64(i+12,l.xmin,!0),t.setFloat64(i+20,l.ymin,!0),t.setFloat64(i+28,l.xmax,!0),t.setFloat64(i+36,l.ymax,!0),t.setInt32(i+44,u,!0),t.setInt32(i+48,a.length,!0),t.setInt32(i+52,0,!0);for(var h=o.reduce((function(t,e){return Array.isArray(e[0][0])?t=t.concat(e):t.push(e),t}),[]),p=1;p<u;p++)t.setInt32(i+52+4*p,h.reduce((function(t,e,r){return r<p?t+e.length:t}),0),!0);a.forEach((function(e,r){t.setFloat64(i+56+16*r+4*(u-1),e[0],!0),t.setFloat64(i+56+16*r+4*(u-1)+8,e[1],!0)})),i+=r+8}.bind(this))}getPartCount(t){return t.reduce((function(t,e){return t+=e.length,Array.isArray(e[0][0][0])&&(t+=e.reduce((function(t,e){return t+e.length-1}),0)),t}),0)}getExtent(){return this.getFlattened(this.geometries_).reduce((function(t,e){return n.b(t,e)}),n.a())}getShpLength(){return 52*this.geometries_.length+4*this.getPartCount(this.geometries_)+16*this.getFlattened(this.geometries_).length}getShxLength(){return 8*this.geometries_.length}}e.a=_},function(t,e,r){"use strict";var n=r(1),i=r(2);class _ extends i.a{constructor(t,e){super(t,e)}writeGeometry(t,e){var r,i=100,_=100;this.geometries_.forEach(function(o,s){var a=this.getFlattened(o);r=40+16*a.length;var u=a.reduce((function(t,e){return n.b(t,e)}),n.a());e.setInt32(_,i/2),e.setInt32(_+4,r/2),_+=8,t.setInt32(i,s+1),t.setInt32(i+4,r/2),t.setInt32(i+8,this.type_,!0),t.setFloat64(i+12,u.xmin,!0),t.setFloat64(i+20,u.ymin,!0),t.setFloat64(i+28,u.xmax,!0),t.setFloat64(i+36,u.ymax,!0),t.setInt32(i+44,a.length,!0),a.forEach((function(e,r){t.setFloat64(i+48+16*r,e[0],!0),t.setFloat64(i+48+16*r+8,e[1],!0)})),i+=r+8}.bind(this))}getPartCount(t){return t.length}getExtent(){return this.getFlattened(this.geometries_).reduce((function(t,e){return n.b(t,e)}),n.a())}getShxLength(){return 8*this.geometries_.length}getShpLength(){return 48*this.geometries_.length+16*this.getFlattened(this.geometries_).length}}e.a=_},function(t,e,r){"use strict";var n=r(1),i=r(2);class _ extends i.a{constructor(t,e){super(t,e)}writeGeometry(t,e){var r=100,n=100;this.geometries_.forEach(function(i,_){e.setInt32(n,r/2),e.setInt32(n+4,10),n+=8,t.setInt32(r,_+1),t.setInt32(r+4,10),t.setInt32(r+8,this.type_,!0),t.setFloat64(r+12,i[0],!0),t.setFloat64(r+20,i[1],!0),r+=28}.bind(this))}getPartCount(t){return t.length}getExtent(){return this.geometries_.reduce((function(t,e){return n.b(t,e)}),n.a())}getShpLength(){return 28*this.geometries_.length}getShxLength(){return 8*this.geometries_.length}}e.a=_},function(t,e,r){"use strict";function n(t,e,r){for(;t.length<e;)t=r+t;return t}function i(t,e,r){for(;t.length<e;)t+=r;return t}function _(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let r=0;const n=t.length;let i=0,_=Math.max(32,n+(n>>1)+7),o=new Uint8Array(_>>3<<3);for(;r<n;){let e=t.charCodeAt(r++);if(e>=55296&&e<=56319){if(r<n){const n=t.charCodeAt(r);56320==(64512&n)&&(++r,e=((1023&e)<<10)+(1023&n)+65536)}if(e>=55296&&e<=56319)continue}if(i+4>o.length){_+=8,_*=1+r/t.length*2,_=_>>3<<3;const e=new Uint8Array(_);e.set(o),o=e}if(0!=(4294967168&e)){if(0==(4294965248&e))o[i++]=e>>6&31|192;else if(0==(4294901760&e))o[i++]=e>>12&15|224,o[i++]=e>>6&63|128;else{if(0!=(4292870144&e))continue;o[i++]=e>>18&7|240,o[i++]=e>>12&63|128,o[i++]=e>>6&63|128}o[i++]=63&e|128}else o[i++]=e}return o.slice(0,i)}var o={C:254,L:1,D:8,N:18,M:18,F:18,B:8},s={string:"C",number:"N",boolean:"L",null:"C"};function a(t){var e={};return t.forEach((function(t){!function(t,e){for(var r in e){var n=void 0!==e[r]&&null!==e[r];(void 0===t[r]||n)&&(t[r]=e[r])}}(e,t)})),function(t){var e={},r=[];for(var n in t)e[n]=null===t[n]?"null":typeof t[n];for(var i in e){var _=s[e[i]];_&&r.push({name:i,type:_,size:o[_]})}return r}(e)}e.a=class{constructor(t,e){this.field_meta_=e||a(t),this.data_=t}write(t){var e=32*this.field_meta_.length,r=this.getBytesPerRecord(this.field_meta_),o=new ArrayBuffer(32+e+1+r*this.data_.length+1),s=new Date,a=new DataView(o);a.setUint8(0,3),a.setUint8(1,s.getFullYear()-1900),a.setUint8(2,s.getMonth()),a.setUint8(3,s.getDate()),a.setUint32(4,this.data_.length,!0);var u=e+32+1;a.setUint16(8,u,!0),a.setUint16(10,r,!0),a.setInt8(32+e,13),this.field_meta_.forEach((function(t,e){let r=t.name.slice(0,10);r=i(r,10," ");let n=_(r);for(let t=0;t<10;t++)a.setInt8(32+32*e+t,n[t]);a.setInt8(32+32*e+11,t.type.charCodeAt(0)),a.setInt8(32+32*e+16,t.size),"N"==t.type&&a.setInt8(32+32*e+17,3)}));var l=e+32+1;this.data_.forEach(function(t,e){a.setUint8(l,32),l++,this.field_meta_.forEach(function(e){var r=t[e.name];switch(null==r&&(r=""),e.type){case"L":a.setUint8(l,r?84:70),l++;break;case"D":l=this.writeField_(a,8,n(r.toString(),8," "),l);break;case"N":l=this.writeField_(a,e.size,n(r.toString(),e.size," ").substr(0,18),l);break;case"C":l=this.writeField_(a,e.size,i(r.toString(),e.size," "),l);break;default:throw new Error("Unknown field type")}}.bind(this))}.bind(this)),a.setUint8(l,26),t(null,{dbf:a})}writeField_(t,e,r,n){let i=_(r);for(var o=0;o<e;o++)t.setUint8(n,i[o]),n++;return n}getBytesPerRecord(t){return t.reduce((function(t,e){return t+e.size}),1)}}},function(t,e,r){"use strict";r.r(e);var n=r(3);window.onload=function(){var t="UTF-8",e='GEOGCS["GCS_China_Geodetic_Coordinate_System_2000",DATUM["D_China_2000",SPHEROID["CGCS2000",6378137.0,298.257222101]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]';$("#btnDownLoad").bind("click",(function(){var r=new JSZip,i=r.folder("layers");console.log(n.a);var _=new n.a('{"type":"FeatureCollection", "features": [{ "type": "Feature", "geometry": { "type": "MultiPoint", "coordinates": [[120, 28], [120, 29]] }, "properties": { "NAME": "测试多点" } }]}');_.writePoint(function(r,n){i.file("point.shp",n.shp.buffer,{binary:!0}),i.file("point.shx",n.shx.buffer,{binary:!0}),i.file("point.dbf",n.dbf.buffer,{binary:!0}),i.file("point.prj",e),i.file("point.cpg",t)}.bind(this)),_.writeMultiPoint(function(r,n){i.file("multipoint.shp",n.shp.buffer,{binary:!0}),i.file("multipoint.shx",n.shx.buffer,{binary:!0}),i.file("multipoint.dbf",n.dbf.buffer,{binary:!0}),i.file("multipoint.prj",e),i.file("multipoint.cpg",t)}.bind(this)),_.writePolyline(function(r,n){i.file("polyline.shp",n.shp.buffer,{binary:!0}),i.file("polyline.shx",n.shx.buffer,{binary:!0}),i.file("polyline.dbf",n.dbf.buffer,{binary:!0}),i.file("polyline.prj",e),i.file("polyline.cpg",t)}.bind(this)),_.writePolygon(function(r,n){i.file("polygon.shp",n.shp.buffer,{binary:!0}),i.file("polygon.shx",n.shx.buffer,{binary:!0}),i.file("polygon.dbf",n.dbf.buffer,{binary:!0}),i.file("polygon.prj",e),i.file("polygon.cpg",t)}.bind(this));r.generateAsync({type:"blob"}).then((function(t){saveAs(t,"example.zip")}))}))}}]);
//# sourceMappingURL=index.js.map